<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>OpenGL ES（一）渲染管线与着色器 | 卫城</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">OpenGL ES（一）渲染管线与着色器</h1><a id="logo" href="/.">卫城</a><p class="description">生活充满各种意外，不负期待。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/guestbook/"><i class="fa fa-comments"> 留言</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">OpenGL ES（一）渲染管线与着色器</h1><div class="post-meta">Dec 6, 2016<span> | </span><span class="category"><a href="/categories/Android-Java-OpenGL/">Android Java OpenGL</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/12/06/OpenGL（一）/" href="/2016/12/06/OpenGL（一）/#comments" class="ds-thread-count"></a><div class="post-content"><p>OpenGL是强大的图像API库，常用于图像处理、游戏开发，Android系统内置了针对移动端(或者说嵌入式设备)的OpenGL ES。</p>
<blockquote>
<ul>
<li><p>Android 1.0开始支持OpenGL ES 1.0，为固定渲染管线。</p>
</li>
<li><p>Android 2.2开始支持OpenGL ES 2.0，为可编程渲染管线。</p>
</li>
<li><p>Android 4.3开始支持OpenGL ES 3.0，更是加入了许多新特性。</p>
</li>
</ul>
</blockquote>
<p>由于Android版本迭代的速度比较慢，为了兼容绝大多数目前的Android机型，目前所有开发者主要使用的都是<a href="https://www.khronos.org/opengles/" target="_blank" rel="external">OpenGL ES2.0</a>。因此本笔记也是以2.0为基础进行记录。</p>
<h2 id="渲染管线"><a href="#渲染管线" class="headerlink" title="渲染管线"></a>渲染管线</h2><p>渲染管线又称渲染流水线，由显卡芯片（GPU）内部处理图像信号的并行处理单元组成，这些处理单元都是各自独立的，越高端的显卡其处理单元也就越多，处理效率越高。CPU和GPU进行图像处理的区别主要在于适用场景，在对于存在时间域上相关的像素点变换，更多是通过CPU进行处理，可以理解CPU处理均为串行的，上一个像素的处理结果在下一个像素点是可以拿到的。而GPU则是并行处理的，它有许许多多的处理单元，每个处理单元独立像素的处理，处理单元当然也可以获取周围像素点的像素，但不能对其进行变更。</p>
<h3 id="OpenGL-ES1-0"><a href="#OpenGL-ES1-0" class="headerlink" title="OpenGL ES1.0"></a>OpenGL ES1.0</h3><p>为了对OpenGL ES2.0有更好的认识与理解，因此我们先从OpenGL ES1.0简单的开始了解。<br><img src="http://wiki.jikexueyuan.com/project/opengl-es-guide/images/42.png" width="500"></p>
<p>以上是OpenGL ES1.0的流程图。</p>
<h4 id="1、元处理"><a href="#1、元处理" class="headerlink" title="1、元处理"></a>1、元处理</h4><p>主要是设定空间对象的顶点坐标、顶点对应的颜色、以及纹理坐标属性，并制定绘制方式（点、线段、三角形等等）</p>
<h4 id="2、变换及光照"><a href="#2、变换及光照" class="headerlink" title="2、变换及光照"></a>2、变换及光照</h4><p>该部分是进行顶点变化以及设定对象的光照属性。顶点变换是对空间对象进行平移、旋转、缩放等等操作，光照属性计算则是通过光源位置、对象坐标、法向量等等信息去计算空间对象的光照属性。</p>
<h4 id="3、图元装配"><a href="#3、图元装配" class="headerlink" title="3、图元装配"></a>3、图元装配</h4><p>该部分主要分为图元的组装与图元的处理。图元组装是指顶点数据根据不同的绘制方式结合成完成的图元。如点绘制过程中只要一个顶点即为图元，而线段绘制方式中需要两个顶点才能结合成完整的图元（线段），三角形绘制方式中则需要三个顶点才能结合成完成的图元（三角形）。图元的处理主要是裁剪，最终绘制在空间中的图像只有在我们的视锥体(视锥体是由我们的视角、远近视面组成的，后面需要的话再详细解释)范围内才会显示出来，在视锥体以外的部分可以理解为盲区，这些看不到的部分被裁减了，因此不会成像在我们的模型中，这部分都是图元处理工作的。</p>
<h4 id="4、光栅化"><a href="#4、光栅化" class="headerlink" title="4、光栅化"></a>4、光栅化</h4><p>虽然在我们的理解中这些绘制的图像都是3D的，但事实上它们也只是展示在我们的手机平面上，也就是2D的展示，为了2D展示能达到3D模型的效果，因此视点观察对象时需要有不同的效果，光栅化就是完成这样的工作。在光栅化过程中，位于远处的片元和位于近处的片元在同一显示平面的坐标点上，这时候近处的片元信息会覆盖远处的像素展示在屏幕上。（3D空间中几何信息通过连续的数学量表示，但目前屏幕显示都是离散化的，因此需要将这些数学量组合成的投影结果离散化。将其分解成一个个离散化的单元，这些单元即称为片元，片元信息包括顶点坐标、顶点颜色、顶点纹理、深度信息等等）</p>
<h4 id="5、纹理采样、颜色求和、雾"><a href="#5、纹理采样、颜色求和、雾" class="headerlink" title="5、纹理采样、颜色求和、雾"></a>5、纹理采样、颜色求和、雾</h4><p>纹理采养是通过当前需要处理的片元与其对应的纹理数据进行采样，获得采样数据。颜色求和负责处理颜色的变化，根据纹理、光照属性计算结果生产片元的颜色。雾即是设置雾环境的参数，颜色、深度、范围等等，<br>后续的几个步骤均顾名思义。</p>
<h4 id="gt-6、帧缓冲"><a href="#gt-6、帧缓冲" class="headerlink" title="&gt;6、帧缓冲"></a>&gt;6、帧缓冲</h4><p>OpenGL ES绘制过程中，并不是直接绘制展示在屏幕上的，而是提前将在一个缓冲区中进行绘制，绘制完一帧图数据后在放入屏幕进行显示。而且每次绘制新的一帧数据时都会将此前的缓冲区数据清楚重绘制，确保数据正确性。帧缓冲是有一组缓冲区数据，应对不同的需要有不同的缓冲区，其中分别缓冲的数据有颜色、深度、模版，后者是用于模版测试使用。</p>
<h3 id="OpenGL-ES2-0"><a href="#OpenGL-ES2-0" class="headerlink" title="OpenGL ES2.0"></a>OpenGL ES2.0</h3><p>而在OpenGL ES2.0改变了以上流程图中间多个步骤（从变化光照到Alpha测试），不再固定渲染管线的工作，顶点的运算是能够编程的，为开发者提供了更广阔的空间进行发挥。</p>
<p><img src="/image/OpenGL1_1.jpeg" width="500"></p>
<h4 id="顶点着色器"><a href="#顶点着色器" class="headerlink" title="顶点着色器"></a>顶点着色器</h4><p><code>顶点着色器</code>替代了变换与光照，因此空间对象的顶点变换、法向量、纹理坐标变换、光照属性等等信息都是通过开发者以着色器代码进行实现的（后续会给例子介绍）。着色器中定义的变量主要有以下几种类型</p>
<ul>
<li><p><code>attribute</code> 指的是每个顶点各自不同的变量值，如顶点的位置、颜色、法向量等等都是不同的，因此都是以attribute的类型存储的，大致可以理解为一个顶点的局部变量。</p>
</li>
<li><p><code>uniform</code> 指的对于一组顶点组成的3D物体中所有顶点均相同的量，比如光源位置信息、视点坐标、视锥体远近平面等等。</p>
</li>
<li><p><code>varying（易变变量）</code> 常常用于从顶点着色器将与片元着色器的数据传递。比如可以将顶点着色器中的顶点坐标、法向量等信息放在易变变量中，然后再片元着色器中进行接收使用。</p>
</li>
<li><p><code>内建变量</code>gl_Position、gl_FrontFacing、gl_PointSize…依次是顶点坐标属性、片元朝向、点大小。</p>
</li>
</ul>
<h4 id="片元着色器"><a href="#片元着色器" class="headerlink" title="片元着色器"></a>片元着色器</h4><p><code>片元着色器</code>是用于处理片元数据，它负责执行纹理的采样工作、颜色总和、雾数据计算等等，它替代了OpenGL ES1.0中的多个步骤，使得开发者的发挥空间得到了大大的拓展，最后处理完的数据再继续完成裁剪、深度、模版测试阶段。</p>
<ul>
<li>gl_FragColor 指的是最终片元颜色，一般会在着色器中对其赋值，在外部处理。（在图像构建过程中，顶点着色器每顶点一次执行，而着色器是每片元一次执行，片元着色器的执行次数明显多于顶点着色器，因此尽可能将复杂的运算部分放在顶点着色器中）</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>此篇文章主要总结了OpenGL ES1.0与2.0渲染管线的差异性，以及着色器的基本介绍，后续会进一步介绍着色器语言及使用实践。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://huangweiwu.info/2016/12/06/OpenGL（一）/" data-id="cix4lr7wl0003laxq9rr5ifaq" class="article-share-link">分享到</a><div class="tags"><a href="/tags/OpenGL-Android/">OpenGL Android</a></div><div class="post-nav"><a href="/2016/12/06/OpenGL（二）/" class="next">OpenGL ES（二）着色语言</a></div><div data-thread-key="2016/12/06/OpenGL（一）/" data-title="OpenGL ES（一）渲染管线与着色器" data-url="http://huangweiwu.info/2016/12/06/OpenGL（一）/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/12/06/OpenGL（一）/" data-title="OpenGL ES（一）渲染管线与着色器" data-url="http://huangweiwu.info/2016/12/06/OpenGL（一）/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://huangweiwu.info"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Java/">Android Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android-Java-OpenGL/">Android Java OpenGL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hi-man/">Hi,man</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/JNI/" style="font-size: 15px;">JNI</a> <a href="/tags/OpenGL-Android/" style="font-size: 15px;">OpenGL Android</a> <a href="/tags/留言板/" style="font-size: 15px;">留言板</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/06/OpenGL（一）/">OpenGL ES（一）渲染管线与着色器</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/06/OpenGL（二）/">OpenGL ES（二）着色语言</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/20/Android NDK-JNI原理/">Android NDK/JNI原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/06/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="" title="暂无" target="_blank">暂无</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">卫城.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'huangweiwu'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>